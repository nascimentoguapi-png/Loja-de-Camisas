<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brazuka 1.1 | Camisas Tailandesas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #000; font-family: sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        .site-container { background-color: #f3f3f3; max-width: 500px; margin: 0 auto; min-height: 100vh; position: relative; padding-bottom: 20px; }
        
        /* BANNER & HEADER */
        .banner-header { width: 100%; height: 130px; overflow: hidden; position: relative; background-color: #000; display: flex; align-items: center; justify-content: center; }
        .banner-img { width: 100%; height: 100%; object-fit: cover; transform: scale(1.2); object-position: center; }
        
        /* MENU LATERAL */
        .side-menu { position: fixed; top: 0; left: -100%; width: 80%; max-width: 300px; height: 100%; background-color: #111; z-index: 200; transition: 0.4s; padding-top: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
        .side-menu.active { left: 0; }
        .side-menu a { display: block; padding: 15px 25px; color: #fff; text-transform: uppercase; font-size: 13px; font-weight: bold; border-bottom: 1px solid #222; text-decoration: none; }
        .side-menu a:active { background-color: #bf953f; color: #000; }
        .overlay-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 150; }
        .btn-menu-trigger { position: absolute; left: 15px; top: 15px; color: #fff; font-size: 22px; cursor: pointer; z-index: 60; background: rgba(0,0,0,0.4); padding: 5px 10px; border-radius: 5px; }

        /* CARROSSEL & CARDS */
        .carousel { position: relative; width: 100%; height: 350px; overflow: hidden; background-color: #000; }
        .carousel-item { display: none; width: 100%; height: 100%; object-fit: cover; }
        .carousel-item.active { display: block; }
        .card-artilheiro { background-color: #fff; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; align-items: center; padding-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .price-main { color: #333; font-size: 1.2rem; font-weight: 800; }
        .atacado-box { border-top: 1px solid #d4af37; border-bottom: 1px solid #d4af37; width: 90%; margin: 5px 0; text-align: center; padding: 2px 0; }
        .btn-dourado { background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c); color: #000; border: none; font-weight: 900; transition: 0.3s; }
        
        /* TAMANHOS */
        .size-box { border: 1px solid #333; width: 28px; height: 26px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; background: white; color: black; }
        .size-selected { background-color: #000 !important; color: #fff !important; }
        .size-off { border: 1px solid #ddd !important; color: #ccc !important; position: relative; cursor: not-allowed !important; pointer-events: none; }
        .size-off::after { content: ""; position: absolute; width: 100%; height: 1px; background: #ccc; transform: rotate(-45deg); }
        
        /* INPUTS */
        .cep-input, .search-input { border: 1px solid #ccc; padding: 8px; border-radius: 4px; width: 100%; font-size: 14px; outline: none; }
        
        /* WHATSAPP FLUTUANTE */
        .btn-whatsapp-fixo { position: fixed; bottom: 20px; right: 20px; background-color: #25d366; color: #fff; width: 60px; height: 60px; border-radius: 50px; text-align: center; font-size: 30px; box-shadow: 2px 2px 10px rgba(0,0,0,0.3); z-index: 90; display: flex; align-items: center; justify-content: center; animation: pulse-green 2s infinite; text-decoration: none; }
        @keyframes pulse-green { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); } }
    </style>
</head>
<body>

<div class="site-container">
    <div id="overlay" class="overlay-menu" onclick="toggleMenu()"></div>
    
    <div id="sideMenu" class="side-menu">
        <div class="px-6 py-4 border-b border-yellow-600 mb-2">
            <h3 class="text-white font-black uppercase text-lg italic">Brazuka 1.1</h3>
        </div>
        <a href="#" onclick="filtrarProdutos('todos')">In√≠cio / Todos</a>
        <a href="#" onclick="filtrarProdutos('torcedor')">Vers√£o Torcedor</a>
        <a href="#" onclick="filtrarProdutos('jogador')">Vers√£o Jogador</a>
        <a href="#" onclick="filtrarProdutos('feminina')">Camisas Femininas</a>
        <a href="#" onclick="filtrarProdutos('selecoes')">Sele√ß√µes</a>
        <a href="#" onclick="filtrarProdutos('retro')">Camisas Retr√¥</a>
        <a href="https://wa.me/5521986285970" target="_blank">Contato / Suporte</a>
    </div>

    <a href="https://wa.me/5521986285970?text=Ol√°! Gostaria de tirar uma d√∫vida." target="_blank" class="btn-whatsapp-fixo">
        <i class="fab fa-whatsapp"></i>
    </a>

    <header class="banner-header sticky top-0 z-50 border-b border-yellow-600 shadow-xl">
        <div class="btn-menu-trigger" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </div>
        <img src="banner-topo.png" alt="Brazuka 1.1" class="banner-img">
        <button onclick="toggleCart()" class="absolute right-3 top-3 bg-black/60 p-2 rounded-full border border-white/20">
            <i class="fas fa-shopping-cart text-xl text-white"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] rounded-full px-1.5 py-0.5 font-bold">0</span>
        </button>
    </header>

    <div class="carousel">
        <img src="banner1.jpg" class="carousel-item active" alt="Promo√ß√£o 1">
        <img src="banner2.jpg" class="carousel-item" alt="Promo√ß√£o 2">
        <img src="banner3.jpg" class="carousel-item" alt="Promo√ß√£o 3">
        <button onclick="moveSlide(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/30 text-white p-2 rounded-full text-xs">‚ùÆ</button>
        <button onclick="moveSlide(1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/30 text-white p-2 rounded-full text-xs">‚ùØ</button>
    </div>

    <div class="p-3 bg-white border-b">
        <div class="relative">
            <input type="text" id="input-busca" onkeyup="buscarNoGrid()" placeholder="Buscar camisa..." class="search-input pl-10">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
    </div>

    <h2 id="titulo-secao" class="bg-black text-white text-center py-2 text-sm font-bold uppercase tracking-widest border-t border-yellow-600 shadow-md">Lan√ßamentos</h2>
    
    <div id="grid-produtos" class="p-2 grid grid-cols-2 gap-2 text-black">
        <p class="text-center col-span-2 py-10">Carregando estoque...</p>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[100] hidden">
        <div class="absolute right-0 top-0 h-full w-[90%] bg-white shadow-xl flex flex-col text-black">
            <div class="p-4 bg-[#333] text-white flex justify-between items-center">
                <h2 class="font-bold uppercase tracking-tighter italic">üõí Meu Carrinho</h2>
                <button onclick="toggleCart()" class="text-3xl">&times;</button>
            </div>
            <div id="cart-items-list" class="flex-1 overflow-y-auto p-4 space-y-6"></div>
            <div class="p-4 bg-gray-100 border-t border-b">
                <label class="text-[10px] font-bold uppercase text-gray-500 mb-1 block">Seu CEP para frete:</label>
                <input type="text" id="cep-destino" placeholder="00000-000" class="cep-input" maxlength="9">
            </div>
            <div class="p-4 bg-gray-50">
                <div id="aviso-atacado" class="text-[10px] text-center font-bold text-green-700 mb-2 hidden">üî• MODO ATACADO ATIVADO!</div>
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span>Subtotal:</span>
                    <span id="subtotal-value">R$ 0,00</span>
                </div>
                <div id="economia-row" class="flex justify-between text-xs text-green-600 font-bold mb-1 hidden">
                    <span>Voc√™ economizou:</span>
                    <span id="economia-value">R$ 0,00</span>
                </div>
                <div class="flex justify-between font-black text-lg mb-4 border-t pt-2">
                    <span>TOTAL:</span>
                    <span id="cart-total-value">R$ 0,00</span>
                </div>
                <button id="btn-finalizar" onclick="enviarWhatsApp()" class="w-full bg-[#28a745] text-white py-4 rounded font-black uppercase text-sm shadow-lg">Finalizar Pedido</button>
            </div>
        </div>
    </div>
</div>

<script>
    // URL DO SEU GOOGLE APPS SCRIPT
    const URL_SCRIPT_ESTOQUE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0m7HN1ePfdwVgr0aaFfYjjFv6r1zag8fZ4x5Ih8XKPLjEIe97nRHqU-hWKWfBEksbOH5Mw8u2Y6VZ/pub?output=csv";
    const linkPlanilha = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0m7HN1ePfdwVgr0aaFfYjjFv6r1zag8fZ4x5Ih8XKPLjEIe97nRHqU-hWKWfBEksbOH5Mw8u2Y6VZ/pub?output=csv";
    
    let produtosData = [], carrinho = [], selecoesTemporarias = {};

    function toggleMenu() {
        const m = document.getElementById('sideMenu');
        const o = document.getElementById('overlay');
        m.classList.toggle('active');
        o.style.display = m.classList.contains('active') ? 'block' : 'none';
    }

    async function carregarProdutos() {
        try {
            const r = await fetch(linkPlanilha);
            const t = await r.text();
            const linhas = t.split('\n').slice(1);
            const grid = document.getElementById('grid-produtos');
            grid.innerHTML = "";
            produtosData = []; 

            linhas.forEach(l => {
                const c = l.split(',');
                if(c.length < 5) return;
                const p = {
                    id: c[0].trim(), 
                    nome: c[1].trim(), 
                    preco: parseFloat(c[2]), 
                    atacado: parseFloat(c[3]), 
                    imagem: c[4].trim(),
                    estoque: { P: parseInt(c[5])||0, M: parseInt(c[6])||0, G: parseInt(c[7])||0, GG: parseInt(c[8])||0 },
                    categoria: c[9] ? c[9].trim().toLowerCase() : "todos"
                };
                produtosData.push(p);
                
                let tams = "";
                for (let tam in p.estoque) {
                    if (p.estoque[tam] > 0) tams += `<button onclick="selecionarTamanho(this, '${p.id}')" class="size-box">${tam}</button>`;
                    else tams += `<button class="size-box size-off">${tam}</button>`;
                }
                grid.innerHTML += `
                    <div class="card-artilheiro item-produto" data-nome="${p.nome.toLowerCase()}" data-cat="${p.categoria}" id="${p.id}">
                        <img src="${p.imagem}" class="w-full h-44 object-cover">
                        <h3 class="text-[10px] px-2 h-8 text-center font-bold mt-1 uppercase">${p.nome}</h3>
                        <span class="price-main">R$ ${p.preco.toFixed(2)}</span>
                        <div class="atacado-box">
                            <span class="text-[8px] text-yellow-700 font-bold uppercase">Atacado (4+ un): R$ ${p.atacado.toFixed(2)}</span>
                        </div>
                        <div class="flex gap-1 my-2">${tams}</div>
                        <button onclick="adicionarAoCarrinho('${p.id}')" class="w-[90%] btn-dourado py-2 rounded text-[11px] uppercase">Comprar</button>
                    </div>`;
            });
        } catch (e) { console.error("Erro ao carregar planilha", e); }
    }

    function buscarNoGrid() {
        const termo = document.getElementById('input-busca').value.toLowerCase();
        document.querySelectorAll('.item-produto').forEach(p => {
            p.style.display = p.getAttribute('data-nome').includes(termo) ? "flex" : "none";
        });
    }

    function filtrarProdutos(cat) {
        toggleMenu();
        const titulo = document.getElementById('titulo-secao');
        const busca = document.getElementById('input-busca');
        busca.value = "";
        titulo.innerText = cat === 'todos' ? "Lan√ßamentos" : cat.replace(/-/g, ' ').toUpperCase();
        document.querySelectorAll('.item-produto').forEach(p => {
            const pCat = p.getAttribute('data-cat');
            p.style.display = (cat === 'todos' || pCat === cat) ? "flex" : "none";
        });
    }

    function selecionarTamanho(btn, id) {
        document.getElementById(id).querySelectorAll('.size-box').forEach(b => b.classList.remove('size-selected'));
        btn.classList.add('size-selected');
        selecoesTemporarias[id] = btn.innerText;
    }

    function adicionarAoCarrinho(id) {
        const p = produtosData.find(x => x.id === id);
        const t = selecoesTemporarias[id];
        if (!t) { alert("Escolha o tamanho!"); return; }
        const jaTem = carrinho.findIndex(i => i.id === id && i.tamanho === t);
        if (jaTem !== -1) carrinho[jaTem].qtd++;
        else carrinho.push({ id, nome: p.nome, tamanho: t, precoVarejo: p.preco, precoAtacado: p.atacado, qtd: 1 });
        document.getElementById('cart-count').innerText = carrinho.reduce((s, i) => s + i.qtd, 0);
        alert("Adicionado!");
    }

    function renderizarCarrinho() {
        const lista = document.getElementById('cart-items-list');
        const aviso = document.getElementById('aviso-atacado');
        const ecoRow = document.getElementById('economia-row');
        let totalF = 0, totalV = 0;
        let qtdT = carrinho.reduce((s, i) => s + i.qtd, 0);
        let eAtacado = qtdT >= 4;

        lista.innerHTML = carrinho.length === 0 ? '<p class="text-center text-gray-400 mt-10">Vazio</p>' : '';
        carrinho.forEach((item, idx) => {
            let precoU = eAtacado ? item.precoAtacado : item.precoVarejo;
            totalF += precoU * item.qtd;
            totalV += item.precoVarejo * item.qtd;
            lista.innerHTML += `
                <div class="flex justify-between items-center border-b pb-2 text-black">
                    <div class="text-[11px]">
                        <p class="font-bold uppercase">${item.nome}</p>
                        <p class="text-red-600 font-bold">TAM: ${item.tamanho} | R$ ${precoU.toFixed(2)}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="alterarQtd(${idx},-1)" class="bg-gray-200 px-2">-</button>
                        <span>${item.qtd}</span>
                        <button onclick="alterarQtd(${idx},1)" class="bg-gray-200 px-2">+</button>
                    </div>
                </div>`;
        });

        let eco = totalV - totalF;
        if (eAtacado && eco > 0) { aviso.classList.remove('hidden'); ecoRow.classList.remove('hidden'); document.getElementById('economia-value').innerText = `R$ ${eco.toFixed(2)}`; }
        else { aviso.classList.add('hidden'); ecoRow.classList.add('hidden'); }
        document.getElementById('subtotal-value').innerText = `R$ ${totalF.toFixed(2)}`;
        document.getElementById('cart-total-value').innerText = `R$ ${totalF.toFixed(2)}`;
    }

    function alterarQtd(i, d) { carrinho[i].qtd += d; if(carrinho[i].qtd <= 0) carrinho.splice(i,1); renderizarCarrinho(); document.getElementById('cart-count').innerText = carrinho.reduce((s, i) => s + i.qtd, 0); }
    function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); renderizarCarrinho(); }
    function moveSlide(n) { const s = document.querySelectorAll(".carousel-item"); let a = 0; s.forEach((img, i) => { if(img.classList.contains('active')){ a = i; img.classList.remove('active'); }}); let next = (a + n + s.length) % s.length; s[next].classList.add('active'); }
    setInterval(() => moveSlide(1), 5000);

    async function enviarWhatsApp() {
        if (!carrinho.length) return;
        const cep = document.getElementById('cep-destino').value;
        if (!cep) { alert("Informe o CEP!"); return; }

        const btn = document.getElementById('btn-finalizar');
        const originalText = btn.innerText;
        btn.innerText = "PROCESSANDO...";
        btn.disabled = true;

        // 1. Enviar baixa de estoque para a planilha
        try {
            const dadosVenda = { itens: carrinho.map(i => ({ id: i.id, tamanho: i.tamanho, qtd: i.qtd })) };
            await fetch(URL_SCRIPT_ESTOQUE, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dadosVenda)
            });
        } catch (e) {
            console.error("Erro ao atualizar estoque:", e);
        }

        // 2. Montar mensagem do WhatsApp
        let qtdT = carrinho.reduce((s, i) => s + i.qtd, 0);
        let eAtacado = qtdT >= 4, totalF = 0, totalV = 0;
        let msg = `üöÄ *PEDIDO BRAZUKA 1.1*\n\n`;
        carrinho.forEach(i => {
            let p = eAtacado ? i.precoAtacado : i.precoVarejo;
            totalF += p * i.qtd; totalV += i.precoVarejo * i.qtd;
            msg += `‚úÖ ${i.qtd}x ${i.nome} (${i.tamanho}) - R$ ${p.toFixed(2)}\n`;
        });
        msg += `\nüí∞ *Total: R$ ${totalF.toFixed(2)}*\nüéÅ Economia: R$ ${(totalV-totalF).toFixed(2)}\nüìç CEP: ${cep}`;
        
        // 3. Abrir WhatsApp e dar Refresh
        window.open(`https://wa.me/5521986285970?text=${encodeURIComponent(msg)}`);
        
        alert("Pedido enviado! Atualizando estoque...");
        setTimeout(() => {
            location.reload();
        }, 1500);
    }

    carregarProdutos();
</script>
</body>
</html>