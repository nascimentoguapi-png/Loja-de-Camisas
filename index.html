<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imp√©rio do Manto | Loja Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #000; font-family: sans-serif; margin: 0; padding: 0; }
        .site-container { background-color: #f3f3f3; max-width: 500px; margin: 0 auto; min-height: 100vh; position: relative; padding-bottom: 20px; }
        
        .banner-header { width: 100%; height: 130px; overflow: hidden; position: relative; background-color: #000; }
        .banner-img { width: 100%; height: 100%; object-fit: cover; transform: scale(1.2); object-position: center; }

        .carousel { position: relative; width: 100%; height: 200px; overflow: hidden; }
        .carousel-item { display: none; width: 100%; height: 100%; object-fit: cover; }
        .carousel-item.active { display: block; }
        
        .card-artilheiro { background-color: #fff; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; align-items: center; padding-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .price-main { color: #333; font-size: 1.2rem; font-weight: 800; }
        .atacado-box { border-top: 1px solid #d4af37; border-bottom: 1px solid #d4af37; width: 90%; margin: 5px 0; text-align: center; padding: 2px 0; }
        
        .btn-dourado { background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c); color: #000; border: none; font-weight: 900; transition: 0.3s; }
        .btn-dourado:active { transform: scale(0.95); filter: brightness(1.2); }

        .size-box { border: 1px solid #333; width: 28px; height: 26px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; background: white; color: black; }
        .size-selected { background-color: #000 !important; color: #fff !important; }
        .size-off { border: 1px solid #ddd !important; color: #ccc !important; position: relative; cursor: not-allowed !important; pointer-events: none; }
        .size-off::after { content: ""; position: absolute; width: 100%; height: 1px; background: #ccc; transform: rotate(-45deg); }
    </style>
</head>
<body>

<div class="site-container">
    <header class="banner-header sticky top-0 z-50 border-b border-yellow-600 shadow-xl">
        <img src="banner-topo.png" alt="Imp√©rio do Manto" class="banner-img">
        <button onclick="toggleCart()" class="absolute right-3 top-3 bg-black/60 p-2 rounded-full border border-white/20">
            <i class="fas fa-shopping-cart text-xl text-white"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] rounded-full px-1.5 py-0.5 font-bold">0</span>
        </button>
    </header>

    <div class="carousel">
        <img src="banner1.jpg" class="carousel-item active">
        <img src="BANNER2.jpg" class="carousel-item">
        <img src="BANNER3.jpg" class="carousel-item">
        <button onclick="moveSlide(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/30 text-white p-2 rounded-full text-xs">‚ùÆ</button>
        <button onclick="moveSlide(1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/30 text-white p-2 rounded-full text-xs">‚ùØ</button>
    </div>

    <h2 class="bg-black text-white text-center py-2 text-sm font-bold uppercase tracking-widest border-t border-yellow-600 shadow-md">Lan√ßamentos</h2>
    
    <div id="grid-produtos" class="p-2 grid grid-cols-2 gap-2 text-black">
        <p class="text-center col-span-2 py-10">Carregando estoque...</p>
    </div>

    <footer class="bg-white border-t mt-6 p-6 text-black text-center">
        <h4 class="font-black uppercase text-sm mb-2">Imp√©rio do Manto</h4>
        <p class="text-xs text-gray-600 mb-4"><i class="fab fa-whatsapp"></i> 5521986285970</p>
        <p class="text-[10px] text-gray-400">¬© 2026 Todos os direitos reservados.</p>
    </footer>

    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[100] hidden">
        <div class="absolute right-0 top-0 h-full w-[90%] bg-white shadow-xl flex flex-col text-black">
            <div class="p-4 bg-[#333] text-white flex justify-between items-center">
                <h2 class="font-bold uppercase tracking-tighter">üõí Meu Carrinho</h2>
                <button onclick="toggleCart()" class="text-3xl">&times;</button>
            </div>
            
            <div id="cart-items-list" class="flex-1 overflow-y-auto p-4 space-y-6"></div>

            <div class="p-4 border-t bg-gray-50">
                <div class="flex justify-between font-black text-lg mb-4">
                    <span>TOTAL:</span>
                    <span id="cart-total-value">R$ 0,00</span>
                </div>
                <button onclick="enviarWhatsApp()" class="w-full bg-[#28a745] text-white py-4 rounded font-black uppercase text-sm shadow-lg">Finalizar no WhatsApp</button>
            </div>
        </div>
    </div>
</div>

<script>
    const linkPlanilha = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0m7HN1ePfdwVgr0aaFfYjjFv6r1zag8fZ4x5Ih8XKPLjEIe97nRHqU-hWKWfBEksbOH5Mw8u2Y6VZ/pub?output=csv";

    let produtosData = []; // Armazena os dados dos produtos para conferir estoque
    let carrinho = [];
    let selecoesTemporarias = {};

    async function carregarProdutos() {
        try {
            const resposta = await fetch(linkPlanilha);
            const dadosText = await resposta.text();
            const linhas = dadosText.split('\n').slice(1);
            const grid = document.getElementById('grid-produtos');
            grid.innerHTML = "";
            produtosData = []; 

            linhas.forEach(linha => {
                const col = linha.split(',');
                if(col.length < 5) return;

                const prod = {
                    id: col[0].trim(),
                    nome: col[1].trim(),
                    preco: parseFloat(col[2]),
                    atacado: parseFloat(col[3]),
                    imagem: col[4].trim(),
                    estoque: { 
                        P: parseInt(col[5]) || 0, 
                        M: parseInt(col[6]) || 0, 
                        G: parseInt(col[7]) || 0, 
                        GG: parseInt(col[8]) || 0 
                    }
                };
                
                produtosData.push(prod);

                let tamanhosHTML = "";
                let estoqueTotal = 0;

                for (let tam in prod.estoque) {
                    const qtd = prod.estoque[tam];
                    estoqueTotal += qtd;
                    if (qtd > 0) {
                        tamanhosHTML += `<button onclick="selecionarTamanho(this, '${prod.id}')" class="size-box">${tam}</button>`;
                    } else {
                        tamanhosHTML += `<button class="size-box size-off">${tam}</button>`;
                    }
                }

                if (estoqueTotal > 0) {
                    grid.innerHTML += `
                        <div class="card-artilheiro" id="${prod.id}">
                            <img src="${prod.imagem}" class="w-full h-44 object-cover">
                            <h3 class="text-[10px] px-2 h-8 text-center leading-tight font-bold mt-1 uppercase">${prod.nome}</h3>
                            <span class="price-main">R$ ${prod.preco.toFixed(2)}</span>
                            <div class="atacado-box">
                                <span class="text-[9px] text-yellow-700 font-bold uppercase">‚Äî Atacado ‚Äî</span>
                                <p class="text-[8px]">M√≠n. 4 un. por <b>R$ ${prod.atacado.toFixed(2)}</b></p>
                            </div>
                            <div class="flex gap-1 my-2">${tamanhosHTML}</div>
                            <button onclick="adicionarAoCarrinho('${prod.id}')" class="w-[90%] btn-dourado py-2 rounded text-[11px] uppercase shadow-md">
                                <i class="fas fa-plus mr-1"></i> Comprar
                            </button>
                        </div>`;
                }
            });
        } catch (e) { console.error(e); }
    }

    let slideIndex = 0;
    function moveSlide(n) {
        const slides = document.querySelectorAll(".carousel-item");
        if(slides.length === 0) return;
        slides[slideIndex].classList.remove("active");
        slideIndex = (slideIndex + n + slides.length) % slides.length;
        slides[slideIndex].classList.add("active");
    }
    setInterval(() => moveSlide(1), 5000);

    function toggleCart() { 
        document.getElementById('cart-modal').classList.toggle('hidden'); 
        renderizarCarrinho(); 
    }

    function selecionarTamanho(botao, produtoId) {
        const container = document.getElementById(produtoId);
        container.querySelectorAll('.size-box').forEach(btn => btn.classList.remove('size-selected'));
        botao.classList.add('size-selected');
        selecoesTemporarias[produtoId] = botao.innerText.trim();
    }

    function adicionarAoCarrinho(produtoId) {
        const produtoInfo = produtosData.find(p => p.id === produtoId);
        const tamanho = selecoesTemporarias[produtoId];
        
        if (!tamanho) { alert("‚ö†Ô∏è Selecione o TAMANHO!"); return; }

        const estoqueDisponivel = produtoInfo.estoque[tamanho];
        const indexCarrinho = carrinho.findIndex(item => item.id === produtoId && item.tamanho === tamanho);
        const qtdNoCarrinho = indexCarrinho !== -1 ? carrinho[indexCarrinho].qtd : 0;

        if (qtdNoCarrinho + 1 > estoqueDisponivel) {
            alert(`‚ùå Desculpe! S√≥ temos ${estoqueDisponivel} unidades do tamanho ${tamanho} em estoque.`);
            return;
        }

        if (indexCarrinho !== -1) {
            carrinho[indexCarrinho].qtd++;
        } else {
            carrinho.push({ 
                id: produtoId, 
                nome: produtoInfo.nome, 
                tamanho: tamanho, 
                preco: produtoInfo.preco, 
                qtd: 1 
            });
        }

        atualizarContador();
        alert("‚úÖ Adicionado!");
    }

    function atualizarContador() {
        const totalItens = carrinho.reduce((sum, item) => sum + item.qtd, 0);
        document.getElementById('cart-count').innerText = totalItens;
    }

    function alterarQtd(index, delta) {
        const item = carrinho[index];
        const produtoInfo = produtosData.find(p => p.id === item.id);
        const estoqueMax = produtoInfo.estoque[item.tamanho];

        if (delta > 0 && item.qtd + delta > estoqueMax) {
            alert("‚ö†Ô∏è Limite de estoque atingido!");
            return;
        }

        item.qtd += delta;
        if (item.qtd <= 0) {
            carrinho.splice(index, 1);
        }
        
        atualizarContador();
        renderizarCarrinho();
    }

    function renderizarCarrinho() {
        const lista = document.getElementById('cart-items-list');
        const totalElement = document.getElementById('cart-total-value');
        let totalGeral = 0;

        lista.innerHTML = carrinho.length === 0 ? '<p class="text-center text-gray-400 mt-10">Carrinho vazio</p>' : '';

        carrinho.forEach((item, index) => {
            const subtotal = item.preco * item.qtd;
            totalGeral += subtotal;

            lista.innerHTML += `
                <div class="flex justify-between items-center border-b pb-4">
                    <div class="flex-1">
                        <p class="font-black text-[11px] uppercase leading-tight">${item.nome}</p>
                        <p class="text-red-600 text-[10px] font-bold">TAM: ${item.tamanho}</p>
                        <p class="text-gray-500 text-[11px]">R$ ${item.preco.toFixed(2)} un.</p>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <div class="flex items-center border rounded bg-gray-100">
                            <button onclick="alterarQtd(${index}, -1)" class="px-2 py-1 text-black font-bold border-r">-</button>
                            <span class="px-3 py-1 font-bold text-sm">${item.qtd}</span>
                            <button onclick="alterarQtd(${index}, 1)" class="px-2 py-1 text-black font-bold border-l">+</button>
                        </div>
                    </div>
                </div>`;
        });

        totalElement.innerText = `R$ ${totalGeral.toFixed(2)}`;
    }

    function enviarWhatsApp() {
        if (carrinho.length === 0) return;
        let totalGeral = carrinho.reduce((sum, item) => sum + (item.preco * item.qtd), 0);
        
        let msg = "üöÄ *NOVO PEDIDO - IMP√âRIO DO MANTO*\n\n";
        carrinho.forEach((item, i) => {
            msg += `*${i+1}.* ${item.nome}\n`;
            msg += `   üì¶ TAM: ${item.tamanho} | Qtd: ${item.qtd}\n`;
            msg += `   üí∞ Sub: R$ ${(item.preco * item.qtd).toFixed(2)}\n\n`;
        });
        msg += `üî• *TOTAL: R$ ${totalGeral.toFixed(2)}*`;
        
        window.location.href = `https://wa.me/5521986285970?text=${encodeURIComponent(msg)}`;
    }

    carregarProdutos();
</script>
</body>
</html>